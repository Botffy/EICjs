<html>
<head>
    <meta charset="utf-8">
    <title>ENTSO-E EIC code validator</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.min.css" />
    <![endif]-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <style type="text/css">
        .monospace {
            font-family: Consolas, Lucida Console, monospace;
        }
        .green {
            color: green;
        }
        .red {
            color: red;
        }

        .eic-errors:empty, .eic-warnings:empty {
            display: none;
        }

        .eic-errors::before {
            content: "Errors: ";
        }

        .eic-warnings::before {
            content: "Warnings: ";
        }

    </style>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.0.1/lodash.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sprintf/1.0.3/sprintf.min.js"></script>
    <script type="text/javascript" src="../eic.js"></script>
    <script type="text/javascript" src="../eic_locale.js"></script>
</head>
<body>
    <div class="github-fork-ribbon-wrapper right">
        <div class="github-fork-ribbon">
            <a href="https://github.com/Botffy/EICjs">Fork me on GitHub</a>
        </div>
    </div>

    <div class="container page-header">
        <h1>EIC code validator</h1>
        <p class="lead">
            This is a simple tool to calculate and validate
            <a href='https://www.entsoe.eu/data/energy-identification-codes-eic/Pages/default.aspx'>ENTSO-E Energy Identification Codes</a>.
            It is by no means official stuff, so don't use it for critical checks or whatever; but it's a useful tool to have handy.
        </p>
    </div>


    <div class='container'>
        <h2>Calculate</h2>

        <p class='lead'>
            Enter the first 15 characters of the identification to calculate the validation character.
        </p>

        <form>
            <div class="form-group">
                <div class="input-group" style="width: 16em">
                    <input type="text" maxlength="15" class="form-control text-uppercase input-lg monospace" id="eic-fragment" value=""></input>
                    <span class="text-uppercase monospace input-group-addon" id='eic-fragment-cc'>?</span>
                </div>
            </div>
        </form>
    </div>

    <div class='container'>
        <h2>Validate</h2>

        <p class='lead'>
            Enter an EIC string in the input box below to validate it.
        </p>

        <form id='eic-validate-form'>
            <div class="form-group">
                <div class="input-group" style="width: 17em">
                    <input type="text" maxlength="16" class="form-control text-uppercase input-lg monospace" id="eic" value=""></input>
                    <span class="input-group-addon"><i id='eic-validity' class='fa fa-fw fa-times red'></i></span>
                </div>
            </div>
            <p class="eic-explain"></p>
            <ul class='eic-errors'></ul>
            <ul class='eic-warnings'></ul>
        </form>
    </div>


    <script type="text/javascript">
        var fragment = $("#eic-fragment");
        var fragment_cc = $("#eic-fragment-cc");

        var ident = $("#eic");
        var eic_validity = $("#eic-validity");

        var eic_validate_form = {
            form: $("#eic-validate-form"),
            explanation: $("#eic-validate-form").find('.eic-explain').first(),
            errors: $("#eic-validate-form").find('.eic-errors').first(),
            warnings: $("#eic-validate-form").find('.eic-warnings').first()
        }

        var warningClass = "fa-exclamation-triangle";
        var errorClass = "red fa-times";
        var validClass = "green fa-check";
        var toRemove = _.join([warningClass, errorClass, validClass], " ");

        var explain = function(validity, form) {
            if(validity.errors.length > 0) {
                form.explanation.text("Invalid EIC code.");
            } else if(validity.warnings.length > 0) {
                form.explanation.text("Almost valid.");
            } else {
                form.explanation.text("Valid EIC code.");
            }

            form.errors.empty();
            form.warnings.empty();
            for(var i=0; i<validity.errors.length; ++i) {
                form.errors.append($('<li>').text(EIC.localizeError(validity.errors[i])));
            }
            for(var i=0; i<validity.warnings.length; ++i) {
                form.warnings.append($('<li>').text(EIC.localizeError(validity.warnings[i])));
            }
        };

        var validateEic = function() {
            if(!ident.val()) {
                eic_validate_form.explanation.text("");
                eic_validate_form.errors.empty();
                eic_validate_form.warnings.empty();
                return;
            }

            var validity = EIC.examine(ident.val());
            console.log(validity);
            var toAdd = undefined;
            if(validity.warnings.length > 0) {
                toAdd = warningClass;
            }
            if(validity.errors.length > 0) {
                toAdd = errorClass;
            }
            if(toAdd === undefined) {
                toAdd = validClass;
            }
            eic_validity.removeClass(toRemove).addClass(toAdd);

            explain(validity, eic_validate_form);
        };

        var calcCheckChar = function(ev) {
            if(!EIC.mayBeEIC(fragment.val())) {
                fragment_cc.text('?');
            } else {
                fragment_cc.text(EIC.calcCheckChar(fragment.val()));
            }
        };

        fragment.bind('input propertychange', calcCheckChar);
        ident.bind('input propertychange', validateEic);
        validateEic();
    </script>
</body>
</html>
